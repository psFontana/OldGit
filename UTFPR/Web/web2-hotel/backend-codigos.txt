backend>routers>api>usuario.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/usuario");
const auth = require("../../../web2-hotel/backend/middlewares/authToken");

router.post("/login", controller.login);
router.get("/usuarios", auth.verificarToken, controller.listar);
router.post("/usuarios", auth.verificarToken, controller.criar);
router.get("/usuarios/:id", auth.verificarToken, controller.detalhar);
router.put("/usuarios/:id", auth.verificarToken, controller.atualizar);
router.delete("/usuarios/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>restaurante.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/restaurante");
const auth = require("../../../web2-hotel/backend/middlewares/authToken");

// Rotas da API para Restaurante
router.get("/", auth.isLogado, controller.listar); // Lista todos os restaurantes
router.get("/:id", auth.isLogado, controller.obter); // Obtém um restaurante específico
router.post("/", auth.isAdmin, controller.criar); // Cria um novo restaurante
router.put("/:id", auth.isAdmin, controller.atualizar); // Atualiza um restaurante existente
router.delete("/:id", auth.isAdmin, controller.excluir); // Exclui um restaurante

module.exports = router;
```

backend>routers>api>pedido.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/pedido.js");
const auth = require("../../../web2-hotel/backend/middlewares/authToken.js");

router.post("/", auth.verificarToken, controller.criar);
router.get("/", auth.verificarToken, controller.listar);
router.get("/:id", auth.verificarToken, controller.detalhar);
router.put("/:id", auth.verificarToken, controller.atualizar);
router.delete("/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>endereco.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../controllers/api/endereco");
const auth = require("../../middlewares/authToken");

router.post("/", auth.verificarToken, controller.criar);
router.get("/", auth.verificarToken, controller.listar);
router.get("/:id", auth.verificarToken, controller.detalhar);
router.put("/:id", auth.verificarToken, controller.atualizar);
router.delete("/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>favorito.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../controllers/api/favorito");
const auth = require("../../middlewares/authToken");

router.post("/", auth.verificarToken, controller.criar);
router.get("/", auth.verificarToken, controller.listar);
router.delete("/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>prato.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/prato");
const auth = require("../../../web2-hotel/backend/middlewares/authToken");

router.post("/", auth.verificarToken, controller.criar);
router.get("/", auth.verificarToken, controller.listar);
router.get("/:id", auth.verificarToken, controller.detalhar);
router.put("/:id", auth.verificarToken, controller.atualizar);
router.delete("/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>usuarioEndereco.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/usuarioEndereco");
const auth = require("../../../web2-hotel/backend/middlewares/authToken");

router.post("/", auth.verificarToken, controller.criar);
router.get("/", auth.verificarToken, controller.listar);
router.delete("/:id", auth.verificarToken, controller.excluir);

module.exports = router;
```

backend>routers>api>usuarioRestaurante.js:
```
const express = require("express");
const router = express.Router();
const controller = require("../../../web2-hotel/backend/controllers/api/usuarioRestaurante");
const auth = require("../../../web2-hotel/backend/middlewares/authToken");

router.post("/vincular", auth.verificarToken, controller.vincular);
router.post("/desvincular", auth.verificarToken, controller.desvincular);
router.get("/", auth.verificarToken, controller.listar);

module.exports = router;
```

backend>controllers>api>endereco.js:
```
const db = require("../../config/db_sequelize");

module.exports = {
  async criar(req, res) {
    try {
      const novoEndereco = await db.Enderecos.create(req.body);
      res.status(201).json(novoEndereco);
    } catch (error) {
      console.error("Erro ao criar endereço:", error);
      res.status(500).send("Erro interno");
    }
  },

  async listar(req, res) {
    try {
      const enderecos = await db.Enderecos.findAll();
      res.json(enderecos);
    } catch (error) {
      console.error("Erro ao listar endereços:", error);
      res.status(500).send("Erro interno");
    }
  },

  async detalhar(req, res) {
    try {
      const endereco = await db.Enderecos.findByPk(req.params.id);
      if (!endereco) return res.status(404).json({ erro: "Endereço não encontrado" });
      res.json(endereco);
    } catch (error) {
      console.error("Erro ao detalhar endereço:", error);
      res.status(500).send("Erro interno");
    }
  },

  async atualizar(req, res) {
    try {
      await db.Enderecos.update(req.body, { where: { id: req.params.id } });
      res.json({ mensagem: "Endereço atualizado com sucesso" });
    } catch (error) {
      console.error("Erro ao atualizar endereço:", error);
      res.status(500).send("Erro interno");
    }
  },

  async excluir(req, res) {
    try {
      await db.Enderecos.destroy({ where: { id: req.params.id } });
      res.status(204).send();
    } catch (error) {
      console.error("Erro ao excluir endereço:", error);
      res.status(500).send("Erro interno");
    }
  }
};
```

backend>controllers>api>favorito.js:
```
const db = require("../../config/db_sequelize");

module.exports = {
  async criar(req, res) {
    try {
      const novoFavorito = await db.Favoritos.create(req.body);
      res.status(201).json(novoFavorito);
    } catch (error) {
      console.error("Erro ao criar favorito:", error);
      res.status(500).send("Erro interno");
    }
  },

  async listar(req, res) {
    try {
      const favoritos = await db.Favoritos.findAll();
      res.json(favoritos);
    } catch (error) {
      console.error("Erro ao listar favoritos:", error);
      res.status(500).send("Erro interno");
    }
  },

  async excluir(req, res) {
    try {
      await db.Favoritos.destroy({ where: { id: req.params.id } });
      res.status(204).send();
    } catch (error) {
      console.error("Erro ao excluir favorito:", error);
      res.status(500).send("Erro interno");
    }
  }
};
```

backend>controllers>api>pedido.js:
```
const PedidoNoSQL = require("../../models/noSql/pedidos");

module.exports = {
  async criar(req, res) {
    try {
      const novoPedido = await PedidoNoSQL.create(req.body);
      res.status(201).json(novoPedido);
    } catch (error) {
      console.error("Erro ao criar pedido:", error);
      res.status(500).send("Erro interno");
    }
  },

  async listar(req, res) {
    try {
      const pedidos = await PedidoNoSQL.find();
      res.json(pedidos);
    } catch (error) {
      console.error("Erro ao listar pedidos:", error);
      res.status(500).send("Erro interno");
    }
  },

  async detalhar(req, res) {
    try {
      const pedido = await PedidoNoSQL.findById(req.params.id);
      if (!pedido) return res.status(404).json({ erro: "Pedido não encontrado" });
      res.json(pedido);
    } catch (error) {
      console.error("Erro ao detalhar pedido:", error);
      res.status(500).send("Erro interno");
    }
  },

  async atualizar(req, res) {
    try {
      const pedidoAtualizado = await PedidoNoSQL.findByIdAndUpdate(req.params.id, req.body, { new: true });
      if (!pedidoAtualizado) return res.status(404).json({ erro: "Pedido não encontrado" });
      res.json(pedidoAtualizado);
    } catch (error) {
      console.error("Erro ao atualizar pedido:", error);
      res.status(500).send("Erro interno");
    }
  },

  async excluir(req, res) {
    try {
      await PedidoNoSQL.findByIdAndDelete(req.params.id);
      res.status(204).send();
    } catch (error) {
      console.error("Erro ao excluir pedido:", error);
      res.status(500).send("Erro interno");
    }
  }
};
```

backend>controllers>api>prato.js:
```
const db = require("../../config/db_sequelize");

module.exports = {
  async criar(req, res) {
    try {
      const novoPrato = await db.Prato.create(req.body);
      res.status(201).json(novoPrato);
    } catch (error) {
      console.error("Erro ao criar prato:", error);
      res.status(500).send("Erro interno");
    }
  },

  async listar(req, res) {
    try {
      const pratos = await db.Prato.findAll();
      res.json(pratos);
    } catch (error) {
      console.error("Erro ao listar pratos:", error);
      res.status(500).send("Erro interno");
    }
  },

  async detalhar(req, res) {
    try {
      const prato = await db.Prato.findByPk(req.params.id);
      if (!prato) return res.status(404).json({ erro: "Prato não encontrado" });
      res.json(prato);
    } catch (error) {
      console.error("Erro ao detalhar prato:", error);
      res.status(500).send("Erro interno");
    }
  },

  async atualizar(req, res) {
    try {
      await db.Prato.update(req.body, { where: { id: req.params.id } });
      res.json({ mensagem: "Prato atualizado com sucesso" });
    } catch (error) {
      console.error("Erro ao atualizar prato:", error);
      res.status(500).send("Erro interno");
    }
  },

  async excluir(req, res) {
    try {
      await db.Prato.destroy({ where: { id: req.params.id } });
      res.status(204).send();
    } catch (error) {
      console.error("Erro ao excluir prato:", error);
      res.status(500).send("Erro interno");
    }
  }
};
```

backend>controllers>api>restaurante.js:
```
const db = require("../../config/db_sequelize");
const Restaurante = db.Restaurante;

module.exports = {
  async listar(req, res) {
    try {
      const dados = await Restaurante.findAll();
      res.status(200).json(dados);
    } catch (err) {
      res.status(500).json({ erro: "Erro ao listar restaurantes" });
    }
  },

  async obter(req, res) {
    try {
      const dado = await Restaurante.findByPk(req.params.id);
      if (!dado) return res.status(404).json({ erro: "Não encontrado" });
      res.status(200).json(dado);
    } catch (err) {
      res.status(500).json({ erro: "Erro ao buscar restaurante" });
    }
  },

  async criar(req, res) {
    try {
      const novo = await Restaurante.create(req.body);
      res.status(201).json(novo);
    } catch (err) {
      res.status(400).json({ erro: "Erro ao criar restaurante" });
    }
  },

  async atualizar(req, res) {
    try {
      const atualizado = await Restaurante.update(req.body, {
        where: { id: req.params.id },
      });
      res.status(200).json({ mensagem: "Atualizado com sucesso" });
    } catch (err) {
      res.status(400).json({ erro: "Erro ao atualizar restaurante" });
    }
  },

  async excluir(req, res) {
    try {
      await Restaurante.destroy({ where: { id: req.params.id } });
      res.status(204).send();
    } catch (err) {
      res.status(500).json({ erro: "Erro ao excluir restaurante" });
    }
  },
};
```

backend>controllers>api>usuario.js:
```
const db = require("../../config/db_sequelize");
const { gerarToken } = require("../../middlewares/authToken");

module.exports = {
  async login(req, res) {
    const { email, senha } = req.body;
    const usuario = await db.Usuario.findOne({ where: { email, senha } });
    if (!usuario) return res.status(401).json({ erro: "Credenciais inválidas" });

    const token = gerarToken(usuario);
    res.json({ token });
  },

  async listar(req, res) {
    const usuarios = await db.Usuario.findAll();
    res.json(usuarios);
  },

  async criar(req, res) {
    const novo = await db.Usuario.create(req.body);
    res.status(201).json(novo);
  },

  async detalhar(req, res) {
    const usuario = await db.Usuario.findByPk(req.params.id);
    if (!usuario) return res.status(404).json({ erro: "Usuário não encontrado" });
    res.json(usuario);
  },

  async atualizar(req, res) {
    const atualizado = await db.Usuario.update(req.body, {
      where: { id: req.params.id }
    });
    res.json({ atualizado });
  },

  async excluir(req, res) {
    await db.Usuario.destroy({ where: { id: req.params.id } });
    res.status(204).send();
  }
};
```

backend>controllers>api>usuarioEndereco.js:
```
const db = require("../../config/db_sequelize");

module.exports = {
  async criar(req, res) {
    try {
      const novoUsuarioEndereco = await db.UsuarioEndereco.create(req.body);
      res.status(201).json(novoUsuarioEndereco);
    } catch (error) {
      console.error("Erro ao criar usuário-endereço:", error);
      res.status(500).send("Erro interno");
    }
  },

  async listar(req, res) {
    try {
      const usuarioEnderecos = await db.UsuarioEndereco.findAll();
      res.json(usuarioEnderecos);
    } catch (error) {
      console.error("Erro ao listar usuário-endereços:", error);
      res.status(500).send("Erro interno");
    }
  },

  async excluir(req, res) {
    try {
      await db.UsuarioEndereco.destroy({ where: { id: req.params.id } });
      res.status(204).send();
    } catch (error) {
      console.error("Erro ao excluir usuário-endereço:", error);
      res.status(500).send("Erro interno");
    }
  }
};
```

backend>controllers>api>usuarioRestaurante.js:
```
const UsuarioMongo = require("../../models/noSql/usuario");
const RestauranteMongo = require("../../models/noSql/restaurante");

module.exports = {
  async vincular(req, res) {
    try {
      const { usuarioId, restauranteId } = req.body;

      if (!usuarioId || isNaN(restauranteId)) {
        return res.status(400).json({ error: "Dados inválidos" });
      }

      const usuario = await UsuarioMongo.findOne({ id: usuarioId });
      const restaurante = await RestauranteMongo.findOne({ id: restauranteId });

      if (!usuario || !restaurante) {
        return res.status(404).json({ error: "Usuário ou restaurante não encontrado" });
      }

      await UsuarioMongo.updateOne(
        { id: usuarioId },
        { $addToSet: { restaurantes: restauranteId } }
      );

      return res.status(201).json({ message: "Restaurante vinculado com sucesso" });
    } catch (error) {
      console.error("Erro ao vincular restaurante:", error);
      return res.status(500).json({ error: "Erro interno" });
    }
  },

  async listar(req, res) {
    try {
      const usuarios = await UsuarioMongo.find();

      const usuariosComRestaurantes = await Promise.all(
        usuarios.map(async (usuario) => {
          const restaurantes = await RestauranteMongo.find({
            id: { $in: usuario.restaurantes || [] }
          });

          return {
            ...usuario.toObject(),
            restaurantes: restaurantes.map(r => r.toObject())
          };
        })
      );

      return res.json(usuariosComRestaurantes);
    } catch (error) {
      console.error("Erro ao listar vínculos:", error);
      return res.status(500).json({ error: "Erro interno" });
    }
  },

  async desvincular(req, res) {
    try {
      const { usuarioId, restauranteId } = req.body;

      if (!usuarioId || isNaN(restauranteId)) {
        return res.status(400).json({ error: "Dados inválidos" });
      }

      const usuario = await UsuarioMongo.findOne({ id: usuarioId });

      if (!usuario) {
        return res.status(404).json({ error: "Usuário não encontrado" });
      }

      await UsuarioMongo.updateOne(
        { id: usuarioId },
        { $pull: { restaurantes: restauranteId } }
      );

      return res.status(200).json({ message: "Restaurante desvinculado com sucesso" });
    } catch (error) {
      console.error("Erro ao desvincular restaurante:", error);
      return res.status(500).json({ error: "Erro interno" });
    }
  }
};
```
backend>config>db_mongoose.js:
```
const mongoose = require("mongoose");

const url = "mongodb://localhost:27017/Web2_PF";

mongoose
  .connect(url, {
    useNewUrlParser: true,
    useUnifiedTopology: true,
  })
  .then(() => console.log("🟢 MongoDB conectado!"))
  .catch((err) => console.error("🔴 Erro ao conectar MongoDB:", err));

module.exports = mongoose;
```

backend>config>db_sequelize.js:
```
const Sequelize = require('sequelize');
const sequelize = new Sequelize('Web2_PF', 'postgres', 'postgres', {
  host: 'localhost',
  dialect: 'postgres'
});

const db = {};

db.Sequelize = Sequelize;
db.sequelize = sequelize;

// Models (relacionais)
db.Enderecos = require('../models/relational/enderecos.js')(sequelize, Sequelize);
db.Favoritos = require('../models/relational/favoritos.js')(sequelize, Sequelize);
db.Pedido = require('../models/relational/pedido.js')(sequelize, Sequelize);
db.Prato = require('../models/relational/prato.js')(sequelize, Sequelize);
db.Restaurante = require('../models/relational/restaurante.js')(sequelize, Sequelize);
db.UsuarioEndereco = require('../models/relational/usuario_endereco.js')(sequelize, Sequelize);
db.Usuario = require('../models/relational/usuario.js')(sequelize, Sequelize);

// Associações
db.Usuario.belongsToMany(db.Enderecos, { through: db.UsuarioEndereco, foreignKey: 'id_usuario', otherKey: 'id_endereco', as: 'enderecos' });

db.Enderecos.belongsToMany(db.Usuario, { through: db.UsuarioEndereco, foreignKey: 'id_endereco', otherKey: 'id_usuario', as: 'usuarios' });

db.Usuario.hasMany(db.Pedido, { foreignKey: 'id_usuario', as: 'pedidos' });

db.Pedido.belongsTo(db.Usuario, { foreignKey: 'id_usuario', as: 'usuario' });

db.Restaurante.hasMany(db.Pedido, { foreignKey: 'id_restaurante', as: 'pedidos' });

db.Pedido.belongsTo(db.Restaurante, { foreignKey: 'id_restaurante', as: 'restaurante' });

db.Restaurante.hasMany(db.Prato, { foreignKey: 'id_restaurante', as: 'pratos' });

db.Prato.belongsTo(db.Restaurante, { foreignKey: 'id_restaurante', as: 'restaurante' });

db.Usuario.hasMany(db.Favoritos, { foreignKey: 'id_usuario', as: 'favoritos' });

db.Favoritos.belongsTo(db.Usuario, { foreignKey: 'id_usuario', as: 'usuario' });

db.Restaurante.hasMany(db.Favoritos, { foreignKey: 'id_restaurante', as: 'favoritos' });

db.Favoritos.belongsTo(db.Restaurante, { foreignKey: 'id_restaurante', as: 'restaurante' });

module.exports = db;
```

backend>controllers>controllerEnderecos.js:
```
const db = require('../config/db_sequelize');

module.exports = {
  async getCreate(req, res) {
    res.render('enderecos/enderecosCreate');
  },

  async postCreate(req, res) {
    try {
      await db.Enderecos.create(req.body);
      res.redirect('/enderecosList');
    } catch (error) {
      console.error('Erro ao criar endereço:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getList(req, res) {
    try {
      const enderecos = await db.Enderecos.findAll();
      res.render('enderecos/enderecosList', { enderecos: enderecos.map(e => e.toJSON()) });
    } catch (error) {
      console.error('Erro ao listar endereços:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getUpdate(req, res) {
    try {
      const endereco = await db.Enderecos.findByPk(req.params.id);
      if (endereco) {
        res.render('enderecos/enderecosUpdate', { endereco: endereco.toJSON() });
      } else {
        res.redirect('/enderecosList');
      }
    } catch (error) {
      console.error('Erro ao carregar endereço:', error);
      res.status(500).send('Erro interno');
    }
  },

  async postUpdate(req, res) {
    try {
      await db.Enderecos.update(req.body, { where: { id: req.body.id } });
      res.redirect('/enderecosList');
    } catch (error) {
      console.error('Erro ao atualizar endereço:', error);
      res.status(500).send('Erro interno ao listar');
    }
  },

  async getDelete(req, res) {
    try {
      await db.Enderecos.destroy({ where: { id: req.params.id } });
      await db.sequelize.query(`ALTER SEQUENCE enderecos_id_seq RESTART WITH 1`);
      res.redirect('/enderecosList');
    } catch (error) {
      console.error('Erro ao deletar endereço:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerFavoritos.js:
```
const db = require('../config/db_sequelize');

module.exports = {
  async getCreate(req, res) {
    res.render('favoritos/favoritosCreate');
  },

  async postCreate(req, res) {
    try {
      await db.Favoritos.create(req.body);
      res.redirect('/favoritosList');
    } catch (error) {
      console.error('Erro ao criar favorito:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getList(req, res) {
    try {
      const favoritos = await db.Favoritos.findAll();
      res.render('favoritos/favoritosList', { favoritos: favoritos.map(f => f.toJSON()) });
    } catch (error) {
      console.error('Erro ao listar favoritos:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getDelete(req, res) {
    try {
      await db.Favoritos.destroy({ where: { id: req.params.id } });
      await db.sequelize.query(`ALTER SEQUENCE favoritos_id_seq RESTART WITH 1`);
      res.redirect('/favoritosList');
    } catch (error) {
      console.error('Erro ao deletar favorito:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getUpdate(req, res) {
    try {
      const favorito = await db.Favoritos.findByPk(req.params.id);
      if (favorito) {
        res.render('favoritos/favoritosUpdate', { favorito: favorito.toJSON() });
      } else {
        res.redirect('/favoritosList');
      }
    } catch (error) {
      console.error('Erro ao carregar favorito:', error);
      res.status(500).send('Erro interno');
    }
  },

  async postUpdate(req, res) {
    try {
      await db.Favoritos.update(req.body, { where: { id: req.body.id } });
      res.redirect('/favoritosList');
    } catch (error) {
      console.error('Erro ao atualizar favorito:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerPedido.js:
```
const db = require('../config/db_sequelize');
const PedidoNoSQL = require('../models/noSql/pedidos');

module.exports = {
  // Página de criação
  async getCreate(req, res) {
    res.render('pedido/pedidoCreate');
  },

  // Ação de criação
  async postCreate(req, res) {
    try {
      const { id_usuario, id_restaurante, data } = req.body;
      // Cria no relacional
      const novoPedido = await db.Pedido.create({
        id_usuario,
        id_restaurante,
        data,
        status: 'Pendente'
      });

      // Cria no NoSQL usando o mesmo id
      await PedidoNoSQL.create({
        id: novoPedido.id,
        id_usuario,
        id_restaurante,
        pratos: [], 
        total: 0,   
        status: 'Pendente',
        data: data || new Date()
      });

      res.redirect('/pedidoList');
    } catch (error) {
      console.error('Erro ao criar pedido:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Listagem de pedidos
  async getList(req, res) {
    try {
      const pedidos = await db.Pedido.findAll();
      res.render('pedido/pedidoList', {
        pedidos: pedidos.map(p => p.toJSON())
      });
    } catch (error) {
      console.error('Erro ao listar pedidos:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Página de edição
  async getUpdate(req, res) {
    try {
      const pedido = await db.Pedido.findByPk(req.params.id);
      if (pedido) {
        res.render('pedido/pedidoUpdate', {
          pedido: pedido.toJSON()
        });
      } else {
        res.status(404).send('Pedido não encontrado');
      }
    } catch (error) {
      console.error('Erro ao buscar pedido:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Ação de atualização
  async postUpdate(req, res) {
    try {
      const { id, id_usuario, id_restaurante, data, status } = req.body;

      await db.Pedido.update(
        { id_usuario, id_restaurante, data, status },
        { where: { id } }
      );

      // Atualiza no NoSQL também
      await PedidoNoSQL.updateOne(
        { id: id },
        { id_usuario, id_restaurante, status, data }
      );

      res.redirect('/pedidoList');
    } catch (error) {
      console.error('Erro ao atualizar pedido:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Ação de exclusão
  async getDelete(req, res) {
    try {
      await db.Pedido.destroy({ where: { id: req.params.id } });

      // Remove do NoSQL também
      await PedidoNoSQL.deleteOne({ id: req.params.id });

      await db.sequelize.query(`ALTER SEQUENCE pedidos_id_seq RESTART WITH 1`);
      res.redirect('/pedidoList');
    } catch (error) {
      console.error('Erro ao deletar pedido:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerPrato.js:
```
const db = require('../config/db_sequelize');

module.exports = {
  async getCreate(req, res) {
    res.render('prato/pratoCreate');
  },

  async postCreate(req, res) {
    try {
      await db.Prato.create(req.body);
      res.redirect('/pratoList');
    } catch (error) {
      console.error('Erro ao criar prato:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getList(req, res) {
    try {
      const pratos = await db.Prato.findAll();
      res.render('prato/pratoList', { pratos: pratos.map(p => p.toJSON()) });
    } catch (error) {
      console.error('Erro ao listar pratos:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getDelete(req, res) {
    try {
      await db.Prato.destroy({ where: { id: req.params.id } });
      await db.sequelize.query(`ALTER SEQUENCE pratos_id_seq RESTART WITH 1`);
      res.redirect('/pratoList');
    } catch (error) {
      console.error('Erro ao deletar prato:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerRestaurante.js:
```
const db = require('../config/db_sequelize');
const RestauranteNoSQL = require('../models/noSql/restaurante');

module.exports = {
  // Página de criação de restaurante
  async getCreate(req, res) {
    res.render('restaurante/restauranteCreate');
  },

  // Ação de criação de restaurante
  async postCreate(req, res) {
    try {
      // Cria no relacional
      const novoRestaurante = await db.Restaurante.create(req.body);

      // Cria no NoSQL usando o mesmo id
      await RestauranteNoSQL.create({
        id: novoRestaurante.id,
        nome: novoRestaurante.nome
      });

      res.redirect('/restauranteList');
    } catch (error) {
      console.error('Erro ao criar restaurante:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Listagem de restaurantes
  async getList(req, res) {
    try {
      const restaurantes = await db.Restaurante.findAll();
      res.render('restaurante/restauranteList', {
        restaurantes: restaurantes.map(r => r.toJSON())
      });
    } catch (error) {
      console.error('Erro ao listar restaurantes:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Página de edição de restaurante
  async getUpdate(req, res) {
    try {
      const restaurante = await db.Restaurante.findByPk(req.params.id);
      if (restaurante) {
        res.render('restaurante/restauranteUpdate', {
          restaurante: restaurante.toJSON()
        });
      } else {
        res.status(404).send('Restaurante não encontrado');
      }
    } catch (error) {
      console.error('Erro ao buscar restaurante:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Ação de atualização de restaurante
  async postUpdate(req, res) {
    try {
      const { id, nome, descricao, endereco } = req.body;

      await db.Restaurante.update(
        { nome, descricao, endereco },
        { where: { id } }
      );

      // Atualiza no NoSQL também
      await RestauranteNoSQL.updateOne(
        { id: id },
        { nome }
      );

      res.redirect('/restauranteList');
    } catch (error) {
      console.error('Erro ao atualizar restaurante:', error);
      res.status(500).send('Erro interno');
    }
  },

  // Ação de exclusão de restaurante
  async getDelete(req, res) {
    try {
      await db.Restaurante.destroy({
        where: { id: req.params.id }
      });

      // Remove do NoSQL também
      await RestauranteNoSQL.deleteOne({ id: req.params.id });

      await db.sequelize.query(`ALTER SEQUENCE restaurantes_id_seq RESTART WITH 1`);
      res.redirect('/restauranteList');
    } catch (error) {
      console.error('Erro ao deletar restaurante:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerUsuario.js:
```
const db = require("../config/db_sequelize");
const UsuarioNoSQL = require("../models/noSql/usuario");

module.exports = {
  // Página de login
  async getLogin(req, res) {
    res.render("usuario/login", { layout: "noMenu.handlebars" });
  },

  // Ação de login
  // Cookies:
  // async postLogin(req, res) {
  //   var user = {
  //     email: req.body.email,
  //   };
  //   db.Usuario.findAll({
  //     where: { email: req.body.email, senha: req.body.senha },
  //   })
  //     .then((usuarios) => {
  //       if (usuarios.length > 0) {
  //         res.cookie("userData", user, {
  //           maxAge: 30 * 60 * 1000,
  //           httpOnly: true,
  //         });
  //         res.render("home");
  //       } else res.redirect("/");
  //     })
  //     .catch((err) => {
  //       console.log(err);
  //     });
  // },

async postLogin(req, res) {
  try {
    const usuarios = await db.Usuario.findAll({
      where: { email: req.body.email, senha: req.body.senha },
    });

    if (usuarios.length > 0) {
      const usuario = usuarios[0];

      // Armazena o usuário na sessão
      req.session.usuario = usuario.dataValues; // Armazena o objeto do usuário

      console.log("Usuário logado:", req.session.usuario.email);
      console.log("Perfil do Usuário:", req.session.usuario.perfil);

      res.redirect("/home"); // Redireciona para a rota home
    } else {
      res.redirect("/");
    }
  } catch (err) {
    console.log(err);
    res.status(500).send("Erro ao realizar login");
  }
},

  // Cookies:
  // async getLogout(req, res) {
  //   res.cookie("userData", ,
  //       req.cookies.userData,
  //     { maxAge: 0, httpOnly: true });
  //     resredirect("/");
  // },

  async getLogout(req, res) {
    req.session.destroy();
    res.redirect("/");
  },

  // Página de cadastro
  async getCreate(req, res) {
    res.render("usuario/usuarioCreate");
  },

  // Ação de criação
  async postCreate(req, res) {
    try {
      // Cria no relacional
      const novoUsuario = await db.Usuario.create(req.body);

      // Cria no NoSQL usando o mesmo id
      await UsuarioNoSQL.create({
        id: novoUsuario.id,
        nome: novoUsuario.nome,
        nascimento: novoUsuario.nascimento,
        email: novoUsuario.email,
        senha: novoUsuario.senha,
        enderecos: [],
        restaurantes: [],
        perfil: novoUsuario.perfil
      });

      res.redirect("/usuarioList");
    } catch (error) {
      console.error("Erro ao criar usuário:", error);
      res.status(500).send("Erro interno");
    }
  },

  // Listagem de usuários
  async getList(req, res) {
    try {
      const usuarios = await db.Usuario.findAll();
      res.render("usuario/usuarioList", {
        usuarios: usuarios.map((user) => user.toJSON()),
      });
    } catch (err) {
      console.error("Erro ao listar usuários:", err);
      res.status(500).send("Erro interno ao listar usuários");
    }
  },

  // Página de edição
  async getUpdate(req, res) {
    try {
      const usuario = await db.Usuario.findByPk(req.params.id);
      if (usuario) {
        const usuarioData = usuario.toJSON();

        // Formata a data para input type="date"
        if (usuarioData.nascimento) {
          usuarioData.nascimento = new Date(usuarioData.nascimento)
            .toISOString()
            .split("T")[0];
        }

        res.render("usuario/usuarioUpdate", { usuario: usuarioData });
      } else {
        res.redirect("/usuarioList");
      }
    } catch (error) {
      console.error("Erro ao carregar usuário:", error);
      res.status(500).send("Erro interno");
    }
  },

  // Ação de atualização
  async postUpdate(req, res) {
    try {
      const dadosAtualizados = {
        nome: req.body.nome,
        email: req.body.email,
        nascimento: req.body.nascimento,
        perfil: req.body.perfil,
      };

      // Só atualiza a senha se ela for preenchida
      if (req.body.senha && req.body.senha.trim() !== "") {
        dadosAtualizados.senha = req.body.senha;
      }

      await db.Usuario.update(dadosAtualizados, {
        where: { id: req.body.id },
      });

      // Atualiza no NoSQL também
      await UsuarioNoSQL.updateOne({ id: req.body.id }, dadosAtualizados);

      res.redirect("/usuarioList");
    } catch (error) {
      console.error("Erro ao atualizar usuário:", error);
      res.status(500).send("Erro interno");
    }
  },

  // Ação de exclusão
  async getDelete(req, res) {
    try {
      await db.Usuario.destroy({
        where: { id: req.params.id },
      });

      // Remove do NoSQL também
      await UsuarioNoSQL.deleteOne({ id: req.params.id });
      
      res.redirect("/usuarioList");
    } catch (error) {
      console.error("Erro ao deletar usuário:", error);
      res.status(500).send("Erro interno");
    }
  },
};
```

backend>controllers>controllerUsuarioEndereco.js:
```
const db = require('../config/db_sequelize');

module.exports = {
  async getCreate(req, res) {
    res.render('usuarioEndereco/usuarioEnderecoCreate');
  },

  async postCreate(req, res) {
    try {
      await db.UsuarioEndereco.create(req.body);
      res.redirect('/usuarioEnderecoList');
    } catch (error) {
      console.error('Erro ao criar usuário-endereço:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getList(req, res) {
    try {
      const usuarioEnderecos = await db.UsuarioEndereco.findAll();
      res.render('usuarioEndereco/usuarioEnderecoList', { usuarioEnderecos: usuarioEnderecos.map(ue => ue.toJSON()) });
    } catch (error) {
      console.error('Erro ao listar usuário-endereço:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getDelete(req, res) {
    try {
      await db.UsuarioEndereco.destroy({ where: { id: req.params.id } });
      res.redirect('/usuarioEnderecoList');
    } catch (error) {
      console.error('Erro ao deletar usuário-endereço:', error);
      res.status(500).send('Erro interno');
    }
  },
  
  async getUpdate(req, res) {
    try {
      const usuarioEndereco = await db.UsuarioEndereco.findByPk(req.params.id);
      if (usuarioEndereco) {
        res.render('usuarioEndereco/usuarioEnderecoUpdate', { usuarioEndereco: usuarioEndereco.toJSON() });
      } else {
        res.redirect('/usuarioEnderecoList');
      }
    } catch (error) {
      console.error('Erro ao carregar usuário-endereço:', error);
      res.status(500).send('Erro interno');
    }
  },

  async postUpdate(req, res) {
    try {
      await db.UsuarioEndereco.update(req.body, { where: { id: req.body.id } });
      res.redirect('/usuarioEnderecoList');
    } catch (error) {
      console.error('Erro ao atualizar usuário-endereço:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>controllers>controllerUsuarioRestaurante.js:
```
const UsuarioMongo = require('../models/noSql/usuario');
const RestauranteMongo = require('../models/noSql/restaurante');

module.exports = {
  async getCreate(req, res) {
    res.render('usuarioRestaurante/usuarioRestauranteCreate');
  },

  async postCreate(req, res) {
    try {
      const usuarioId = req.body.usuarioId;
      const restauranteId = Number(req.body.restauranteId);

      if (isNaN(restauranteId)) {
        return res.status(400).send('ID do restaurante inválido');
      }

      const restauranteExists = await RestauranteMongo.findOne({ id: restauranteId });
      if (!restauranteExists) {
        return res.status(404).send('Restaurante não encontrado');
      }

      await UsuarioMongo.updateOne(
        { id: usuarioId },
        { $addToSet: { restaurantes: restauranteId } }
      );

      res.redirect('/usuarioRestauranteList');
    } catch (error) {
      console.error('Erro ao adicionar restaurante ao usuário:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getList(req, res) {
    try {
      const usuariosMongo = await UsuarioMongo.find();

      const usuariosComRestaurantes = await Promise.all(
        usuariosMongo.map(async (usuario) => {
          const restaurantes = await RestauranteMongo.find({
            id: { $in: usuario.restaurantes || [] }
          });

          return {
            ...usuario.toObject(),
            restaurantes: restaurantes.map(r => r.toObject())
          };
        })
      );

      res.render('usuarioRestaurante/usuarioRestauranteList', {
        usuariosMongo: usuariosComRestaurantes
      });
    } catch (error) {
      console.error('Erro ao listar usuários:', error);
      res.status(500).send('Erro interno');
    }
  },

  async getDelete(req, res) {
    try {
      const usuarioId = Number(req.params.usuarioId);
      const restauranteId = Number(req.params.restauranteId);
      const userLogado = req.session.usuario;

      if (!userLogado) {
        return res.status(401).send('Usuário não autenticado');
      }

      const usuarioAlvo = await UsuarioMongo.findOne({ id: usuarioId });
      const restaurante = await RestauranteMongo.findOne({ id: restauranteId });

      if (!usuarioAlvo || !restaurante) {
        return res.status(404).send('Usuário ou restaurante não encontrado');
      }


      if (userLogado.perfil === 'admin') {
        await UsuarioMongo.updateOne(
          { id: usuarioId },
          { $pull: { restaurantes: restauranteId } }
        );
        return res.redirect('/usuarioRestauranteList');
      }


      if (userLogado.perfil === 'dono' && restaurante.usuarioId === userLogado.id) {
        await UsuarioMongo.updateOne(
          { id: usuarioId },
          { $pull: { restaurantes: restauranteId } }
        );
        return res.redirect('/usuarioRestauranteList');
      }

      return res.status(403).send('Você não tem permissão para remover este restaurante');
    } catch (error) {
      console.error('Erro ao deletar restaurante:', error);
      res.status(500).send('Erro interno');
    }
  },


  async getUpdate(req, res) {
    try {
      const usuarioId = req.params.id;
      const usuarioDoc = await UsuarioMongo.findOne({ id: usuarioId });

      if (usuarioDoc) {
        const usuario = usuarioDoc.toObject(); // <-- ESSENCIAL
        res.render('usuarioRestaurante/usuarioRestauranteUpdate', { usuario });
      } else {
        res.redirect('/usuarioRestauranteList');
      }
    } catch (error) {
      console.error('Erro ao carregar usuário:', error);
      res.status(500).send('Erro interno');
    }
  }
  ,

  async postUpdate(req, res) {
    try {
      const usuarioId = req.body.id;
      const restaurantesString = req.body.restaurantes || '';
      const restaurantesArray = restaurantesString
        .split(',')
        .map(id => Number(id.trim()))
        .filter(id => !isNaN(id));

      await UsuarioMongo.updateOne(
        { id: usuarioId },
        {
          $set: {
            restaurantes: restaurantesArray
          }
        }
      );

      res.redirect('/usuarioRestauranteList');
    } catch (error) {
      console.error('Erro ao atualizar usuário:', error);
      res.status(500).send('Erro interno');
    }
  }
};
```

backend>middlewares>accessControl.js:
```
module.exports = (allowedProfiles) => {
  return (req, res, next) => {
    const user = req.session.usuario;

    if (!user) {
      return res.redirect("/login");
    }

    if (!allowedProfiles.includes(user.perfil)) {
      return res.status(403).send("Acesso negado.");
    }

    next();
  };
};
```

backend>middlewares>authToken.js:
```
const jwt = require("jsonwebtoken");
const SECRET = "seuSegredoSuperSeguro"; // Ideal: use process.env.JWT_SECRET

module.exports = {
  gerarToken(usuario) {
    return jwt.sign({ id: usuario.id, perfil: usuario.perfil }, SECRET, { expiresIn: "2h" });
  },

  verificarToken(req, res, next) {
    const token = req.headers.authorization?.split(" ")[1];
    if (!token) return res.status(401).json({ erro: "Token não fornecido" });

    jwt.verify(token, SECRET, (err, decoded) => {
      if (err) return res.status(403).json({ erro: "Token inválido" });
      req.usuario = decoded;
      next();
    });
  },

  isLogado(req, res, next) {
    module.exports.verificarToken(req, res, next);
  },

  isAdmin(req, res, next) {
    module.exports.verificarToken(req, res, () => {
      if (req.usuario.perfil === "admin") {
        next();
      } else {
        res.status(403).json({ erro: "Acesso restrito a administradores" });
      }
    });
  },

  isDono(req, res, next) {
    module.exports.verificarToken(req, res, () => {
      if (req.usuario.perfil === "dono") {
        next();
      } else {
        res.status(403).json({ erro: "Acesso restrito a donos de restaurante" });
      }
    });
  },

  isCliente(req, res, next) {
    module.exports.verificarToken(req, res, () => {
      if (req.usuario.perfil === "cliente") {
        next();
      } else {
        res.status(403).json({ erro: "Acesso restrito a clientes" });
      }
    });
  }
};
```

backend>middlewares>middlewares.js:
```
module.exports = {
  logRegister(req, res, next) {
    console.log(req.url + req.method + new Date())
    next();
  },
  sessionControl(req, res, next) {
    if (req.session.login != undefined) next();
    else if ((req.url == '/') && (req.method == 'GET')) next();
    else if ((req.url == '/login') && (req.method == 'POST')) next();
    else if ((req.url).split('/')[1] == 'recuperarSenha') next();
    else res.redirect('/');
  }
};
```

backend>middlewares>sessionControl.js:
```
module.exports = (req, res, next) => {
  const user = req.session.usuario;
  const rotaPublica = ['/', '/login'].includes(req.path);

  if (!user && rotaPublica) return next();
  if (!user) return res.redirect('/login');

  // Define layout dinâmico
  switch (user.perfil) {
    case "admin":
      res.locals.layout = "adminMain";
      break;
    case "dono":
      res.locals.layout = "donoMain";
      break;
    case "cliente":
      res.locals.layout = "clienteMain";
      break;
    default:
      res.locals.layout = "main";
  }

  return next();
};
```

backend>models>noSql>pedidos.js:
```
const mongoose = require('mongoose');
const Schema = mongoose.Schema;

const PedidoSchema = new Schema({
  id: { type: Number, required: true, unique: true }, 
  id_usuario: { type: Number, required: true },
  id_restaurante: { type: Number, required: true },
  pratos: [{
    nome: { type: String, required: true },
    descricao: String,
    preco: Number,
    comentarios: [{
      autor: String,
      texto: String,
      data: { type: Date, default: Date.now }
    }]
  }],
  total: { type: Number, required: true },
  status: { type: String, required: true, enum: ['Pendente', 'Em Preparação', 'Entregue'] },
  data: { type: Date, default: Date.now }
});

module.exports = mongoose.model("Pedido", PedidoSchema);
```

backend>models>noSql>restaurante.js:
```
const mongoose = require('mongoose');
const Schema = mongoose.Schema;

const RestauranteSchema = new Schema({
  id: { type: Number, required: true, unique: true },
  nome: { type: String, required: true },
  pratos: [{
    nome: { type: String, required: true },
    descricao: String,
    preco: Number,
    comentarios: [{
      autor: String,
      texto: String,
      data: { type: Date, default: Date.now }
    }]
  }]
});

module.exports = mongoose.model("Restaurante", RestauranteSchema);
```

backend>models>noSql>usuario.js:
```
const mongoose = require('mongoose');
const Schema = mongoose.Schema;

const UsuarioSchema = new Schema({
  id: { type: Number, required: true, unique: true },
  nome: { type: String, required: true },
  nascimento: { type: Date, required: true },
  email: { type: String, required: true, unique: true },
  senha: { type: String, required: true },
  enderecos: [{ type: Schema.Types.Number, ref: 'Endereco' }],
  restaurantes: [{ type: Schema.Types.Number, ref: 'Restaurante' }],
  perfil: { type: String, enum: ['admin', 'dono', 'cliente'], default: 'cliente' },
});

module.exports = mongoose.model("Usuario", UsuarioSchema);
```

backend>models>relational>enderecos.js:
```
module.exports = (sequelize, Sequelize) => {
	const Enderecos = sequelize.define('enderecos', {
		id: {
			type: Sequelize.INTEGER,
			autoIncrement: true, allowNull: false, primaryKey: true
		},
		cep: {
			type: Sequelize.STRING(10), allowNull: false
		},
		numero: {
			type: Sequelize.STRING, allowNull: false
		},
		complemento: {
			type: Sequelize.STRING, allowNull: false
		}
	});
	return Enderecos
		;
}
```

backend>models>relational>favoritos.js:
```
module.exports = (sequelize, Sequelize) => {
  const Favoritos = sequelize.define('favoritos', {
    id: {
      type: Sequelize.INTEGER,
      autoIncrement: true, allowNull: false, primaryKey: true
    },
    id_usuario: {
      type: Sequelize.INTEGER, allowNull: false,
      references: { model: 'usuarios', key: 'id' }
    },
    id_restaurante: {
      type: Sequelize.INTEGER, allowNull: false,
      references: { model: 'restaurantes', key: 'id' }
    }
  }, {
    timestamps: false
  });
  return Favoritos;
}
```

backend>models>relational>pedido.js:
```
module.exports = (sequelize, Sequelize) => {
  const Pedido = sequelize.define('pedido', {
    id: {
      type: Sequelize.INTEGER,
      autoIncrement: true, allowNull: false, primaryKey: true
    },
    id_usuario: {
      type: Sequelize.INTEGER, allowNull: false,
      references: { model: 'usuarios', key: 'id' }
    },
    id_restaurante: {
      type: Sequelize.INTEGER, allowNull: false,
      references: { model: 'restaurantes', key: 'id' }
    },
    data: {
      type: Sequelize.DATEONLY,
      allowNull: false
    },
    status: {
      type: Sequelize.STRING,
      allowNull: false
    }
  }, {
    timestamps: false
  });

  return Pedido;
};
```

backend>models>relational>prato.js:
```
module.exports = (sequelize, Sequelize) => {
  const Prato = sequelize.define('prato', {
    id: {
      type: Sequelize.INTEGER,
      autoIncrement: true, allowNull: false, primaryKey: true
    },
    nome: {
      type: Sequelize.STRING, allowNull: false
    },
    preco: {
      type: Sequelize.FLOAT, allowNull: false
    },
    id_restaurante: {
      type: Sequelize.INTEGER, allowNull: false,
      references: { model: 'restaurantes', key: 'id' }
    }
  }, {
    timestamps: false
  });
  return Prato;
}
```

backend>models>relational>restaurante.js:
```
module.exports = (sequelize, Sequelize) => {
  const Restaurante = sequelize.define('restaurante', {
    id: {
      type: Sequelize.INTEGER,
      autoIncrement: true, allowNull: false, primaryKey: true
    },
    nome: {
      type: Sequelize.STRING, allowNull: false
    }
  }, {
    timestamps: true
  });
  return Restaurante;
}
```

backend>routers>route.js:
```
const express = require("express");
const route = express.Router();

// Middlewares
const sessionControl = require("../middlewares/sessionControl.js");
const accessControl = require("../middlewares/accessControl.js");

// Controllers
const controllerUsuario = require("../controllers/controllerUsuario.js");
const controllerRestaurante = require("../controllers/controllerRestaurante.js");
const controllerPrato = require("../controllers/controllerPrato.js");
const controllerEnderecos = require("../controllers/controllerEnderecos.js");
const controllerPedido = require("../controllers/controllerPedido.js");
const controllerFavorito = require("../controllers/controllerFavoritos.js");
const controllerUsuarioEndereco = require("../controllers/controllerUsuarioEndereco.js");
const controllerUsuarioRestaurante = require("../controllers/controllerUsuarioRestaurante.js");

// Redireciona raiz para login
route.get("/", (req, res) => res.redirect("/login"));

// Página de login
route.get("/login", controllerUsuario.getLogin);
route.post("/login", controllerUsuario.postLogin);

route.get("/logout", controllerUsuario.getLogout);

// Página home (após login) com menu
// Cookies:
// route.get("/home", function (req, res) {
//   if (req.cookies.controllerUsuarioEndereco) {
//     res.render("home");
//   } else res.redirect("/");
// });

// ---------- Home ----------
route.get("/home", sessionControl, (req, res) => {
  // Renderiza a página inicial com o layout apropriado
  res.render("home", { layout: res.locals.layout }); // Usa o layout definido no middleware
});

// ---------- Usuário ----------
route.get(
  "/usuarioCreate",
  accessControl(["admin"]),
  controllerUsuario.getCreate
);
route.post(
  "/usuarioCreate",
  accessControl(["admin"]),
  controllerUsuario.postCreate
);

route.get("/usuarioList", accessControl(["admin"]), controllerUsuario.getList);

route.get(
  "/usuarioUpdate/:id",
  accessControl(["admin"]),
  controllerUsuario.getUpdate
);
route.post(
  "/usuarioUpdate",
  accessControl(["admin"]),
  controllerUsuario.postUpdate
);

route.get(
  "/usuarioDelete/:id",
  accessControl(["admin"]),
  controllerUsuario.getDelete
);

// ---------- Restaurante ----------
route.get("/restauranteList", controllerRestaurante.getList);
route.get(
  "/restauranteCreate",
  accessControl(["admin", "dono"]),
  controllerRestaurante.getCreate
);
route.post(
  "/restauranteCreate",
  accessControl(["admin", "dono"]),
  controllerRestaurante.postCreate
);
route.get(
  "/restauranteDelete/:id",
  accessControl(["admin", "dono"]),
  controllerRestaurante.getDelete
);
route.get(
  "/restauranteUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerRestaurante.getUpdate
);
route.post(
  "/restauranteUpdate",
  accessControl(["admin", "dono"]),
  controllerRestaurante.postUpdate
);

// ---------- Prato ----------
route.get(
  "/pratoList",
  accessControl(["admin", "dono"]),
  controllerPrato.getList
);
route.get(
  "/pratoCreate",
  accessControl(["admin", "dono"]),
  controllerPrato.getCreate
);
route.post(
  "/pratoCreate",
  accessControl(["admin", "dono"]),
  controllerPrato.postCreate
);
route.get(
  "/pratoDelete/:id",
  accessControl(["admin", "dono"]),
  controllerPrato.getDelete
);

// ---------- Endereço ----------
route.get(
  "/enderecosList",
  accessControl(["admin", "dono"]),
  controllerEnderecos.getList
);
route.get(
  "/enderecosCreate",
  accessControl(["admin", "dono"]),
  controllerEnderecos.getCreate
);
route.post(
  "/enderecosCreate",
  accessControl(["admin", "dono"]),
  controllerEnderecos.postCreate
);
route.get(
  "/enderecosUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerEnderecos.getUpdate
);
route.post(
  "/enderecosUpdate",
  accessControl(["admin", "dono"]),
  controllerEnderecos.postUpdate
);
route.get(
  "/enderecosDelete/:id",
  accessControl(["admin", "dono"]),
  controllerEnderecos.getDelete
);

// ---------- Pedido ----------
route.get(
  "/pedidoList",
  accessControl(["admin", "dono"]),
  controllerPedido.getList
);
route.get(
  "/pedidoCreate",
  accessControl(["admin", "dono"]),
  controllerPedido.getCreate
);
route.post(
  "/pedidoCreate",
  accessControl(["admin", "dono"]),
  controllerPedido.postCreate
);
route.get(
  "/pedidoUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerPedido.getUpdate
);
route.post(
  "/pedidoUpdate",
  accessControl(["admin", "dono"]),
  controllerPedido.postUpdate
);
route.get(
  "/pedidoDelete/:id",
  accessControl(["admin", "dono"]),
  controllerPedido.getDelete
);

// ---------- Favorito ----------
route.get(
  "/favoritosList",
  accessControl(["admin", "dono"]),
  controllerFavorito.getList
);
route.get(
  "/favoritosCreate",
  accessControl(["admin", "dono"]),
  controllerFavorito.getCreate
);
route.post(
  "/favoritosCreate",
  accessControl(["admin", "dono"]),
  controllerFavorito.postCreate
);
route.get(
  "/favoritosUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerFavorito.getUpdate
);
route.post(
  "/favoritosUpdate",
  accessControl(["admin", "dono"]),
  controllerFavorito.postUpdate
);
route.get(
  "/favoritosDelete/:id",
  accessControl(["admin", "dono"]),
  controllerFavorito.getDelete
);

// ---------- Usuario Endereco ----------
route.get(
  "/usuarioEnderecoList",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.getList
);
route.get(
  "/usuarioEnderecoCreate",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.getCreate
);
route.post(
  "/usuarioEnderecoCreate",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.postCreate
);
route.get(
  "/usuarioEnderecoUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.getUpdate
);
route.post(
  "/usuarioEnderecoUpdate",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.postUpdate
);
route.get(
  "/usuarioEnderecoDelete/:id",
  accessControl(["admin", "dono"]),
  controllerUsuarioEndereco.getDelete
);

// ---------- Usuario Restaurante ----------
route.get(
  "/usuarioRestauranteList",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.getList
);
route.get(
  "/usuarioRestauranteCreate",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.getCreate
);
route.post(
  "/usuarioRestauranteCreate",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.postCreate
);
route.get(
  "/usuarioRestauranteUpdate/:id",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.getUpdate
);
route.post(
  "/usuarioRestauranteUpdate",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.postUpdate
);
route.get(
  "/usuarioRestauranteDelete/:usuarioId/:restauranteId",
  accessControl(["admin", "dono"]),
  controllerUsuarioRestaurante.getDelete
);

module.exports = route;
```

backend>swagger>swagger.json:
```
{
  "openapi": "3.0.0",
  "info": {
    "title": "API de Usuários",
    "version": "1.0.0"
  },
  "paths": {
    "/api/login": {
      "post": {
        "summary": "Login de usuário",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": { "type": "string" },
                  "senha": { "type": "string" }
                },
                "required": ["email", "senha"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login bem-sucedido - retorna token JWT",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "token": {
                      "type": "string",
                      "description": "Token JWT para autenticação"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Credenciais inválidas"
          }
        }
      }
    },
    "/api/usuarios": {
      "get": {
        "summary": "Lista todos os usuários",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de usuários"
          }
        }
      },
      "post": {
        "summary": "Cria um novo usuário",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nome": { "type": "string" },
                  "nascimento": { "type": "string", "format": "date" },
                  "email": { "type": "string" },
                  "senha": { "type": "string" },
                  "perfil": { "type": "string" }
                },
                "required": ["nome", "email", "senha", "perfil"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Usuário criado com sucesso"
            }
          }
        }
      }
    },
    "/api/pedido": {
      "post": {
        "summary": "Cria um novo pedido",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id_usuario": { "type": "number" },
                  "id_restaurante": { "type": "number" },
                  "pratos": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "nome": { "type": "string" },
                        "descricao": { "type": "string" },
                        "preco": { "type": "number" }
                      }
                    }
                  },
                  "total": { "type": "number" },
                  "status": {
                    "type": "string",
                    "enum": ["Pendente", "Em Preparação", "Entregue"]
                  }
                },
                "required": ["id_usuario", "id_restaurante", "pratos", "total", "status"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Pedido criado com sucesso"
            }
          }
        }
      },
      "get": {
        "summary": "Lista todos os pedidos",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de pedidos"
          }
        }
      }
    },
    "/api/endereco": {
      "post": {
        "summary": "Cria um novo endereço",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "cep": { "type": "string" },
                  "numero": { "type": "string" },
                  "complemento": { "type": "string" }
                },
                "required": ["cep", "numero"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Endereço criado com sucesso"
            }
          }
        }
      },
      "get": {
        "summary": "Lista todos os endereços",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de endereços"
          }
        }
      }
    },
    "/api/favorito": {
      "post": {
        "summary": "Cria um novo favorito",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id_usuario": { "type": "number" },
                  "id_restaurante": { "type": "number" }
                },
                "required": ["id_usuario", "id_restaurante"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Favorito criado com sucesso"
            }
          }
        }
      },
      "get": {
        "summary": "Lista todos os favoritos",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de favoritos"
          }
        }
      }
    },
    "/api/prato": {
      "post": {
        "summary": "Cria um novo prato",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nome": { "type": "string" },
                  "preco": { "type": "number" },
                  "id_restaurante": { "type": "number" }
                },
                "required": ["nome", "preco", "id_restaurante"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Prato criado com sucesso"
            }
          }
        }
      },
      "get": {
        "summary": "Lista todos os pratos",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de pratos"
          }
        }
      }
    },
    "/api/usuarioEndereco": {
      "post": {
        "summary": "Cria um novo usuário-endereço",
        "security": [{ "bearerAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "id_usuario": { "type": "number" },
                  "id_endereco": { "type": "number" }
                },
                "required": ["id_usuario", "id_endereco"]
              }
            }
          },
          "responses": {
            "201": {
              "description": "Usuário-endereço criado com sucesso"
            }
          }
        }
      },
      "get": {
        "summary": "Lista todos os usuários-endereços",
        "security": [{ "bearerAuth": [] }],
        "responses": {
          "200": {
            "description": "Lista de usuários-endereços"
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
```

backend>app.js:
```
const express = require("express");
const handlebars = require("express-handlebars");
const cookieParser = require("cookie-parser");
const session = require("express-session");

const db = require("./config/db_sequelize");
const mongoose = require("./config/db_mongoose");
const sessionControl = require("./middlewares/sessionControl");
const routes = require("./routers/route");

const swaggerUi = require("swagger-ui-express");
const swaggerDocument = require("./swagger/swagger.json");
const rotaApiUsuario = require("./routers/api/usuario");
const rotaApiRestaurante = require("./routers/api/restaurante");
const rotaApiPedido = require("./routers/api/pedido");
const rotaApiEndereco = require("./routers/api/endereco");
const rotaApiFavorito = require("./routers/api/favorito");
const rotaApiPrato = require("./routers/api/prato");
const rotaApiUsuarioEndereco = require("./routers/api/usuarioEndereco");
const rotaApiUsuarioRestaurante = require("./routers/api/usuarioRestaurante");

const app = express();

// Configuração do Handlebars
app.engine("handlebars", handlebars.engine());
app.set("view engine", "handlebars");

// Middlewares essenciais para API
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.use("/api", rotaApiUsuario);
app.use("/api/restaurante", rotaApiRestaurante);
app.use("/api/pedido", rotaApiPedido);
app.use("/api/endereco", rotaApiEndereco);
app.use("/api/favorito", rotaApiFavorito);
app.use("/api/prato", rotaApiPrato);
app.use("/api/usuarioEndereco", rotaApiUsuarioEndereco);
app.use("/api/usuarioRestaurante", rotaApiUsuarioRestaurante);
app.use("/api-docs", swaggerUi.serve, swaggerUi.setup(swaggerDocument));

// Middlewares para sessão
app.use(cookieParser());
app.use(
  session({
    secret: "seilaman",
    cookie: { maxAge: 30 * 60 * 1000 },
    resave: false,
    saveUninitialized: true,
  })
);

// Middlewares das rotas web com proteção de sessão
app.use(sessionControl);
app.use(routes);

// Sincronização com Sequelize
db.sequelize
  .sync()
  .then(async () => {
    console.log("🟢 Banco sincronizado.");

    const UsuarioModel = db.Usuario;

    const adminExistente = await UsuarioModel.findOne({
      where: { email: "admin@admin.com" },
    });

    if (!adminExistente) {
      await UsuarioModel.create({
        nome: "Administrador",
        nascimento: new Date(2005, 4, 27),
        email: "admin@admin.com",
        senha: "admin", // Em produção, use hash
        perfil: "admin",
      });
      console.log("🔐 Usuário admin criado com sucesso!");
    } else {
      console.log("🔐 Usuário admin já existe.");
    }

    app.listen(8081, () => {
      console.log("Servidor no http://localhost:8081");
      console.log("Estado do Mongoose:", mongoose.connection.readyState);
    });
  })
  .catch((err) => {
    console.error("🔴 Erro ao sincronizar banco: ", err);
  });
```