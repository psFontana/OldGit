document.getElementById("reserva").addEventListener("submit", (event) => {
  event.preventDefault();

  const valoresQuartos = {
    economico: 150.0,
    conforto: 300.0,
    luxo: 500.0,
    presidencial: 1000.0
  };
  const nome = document.getElementById("nome").value.trim();
  const telefone = document.getElementById("telefone").value.trim();
  const email = document.getElementById("email").value.trim();
  const comprovante = document.getElementById("comprovante").files[0];
  const quarto = document.querySelector('input[name="tipoQuarto"]:checked').value.trim();
  const pessoas = parseInt(document.getElementById("quantidadePessoas").value.trim());
  const checkin = new Date(document.getElementById("checkin").value)
  const checkout = new Date(document.getElementById("checkout").value)
  const dias = (checkout - checkin) / (1000 * 60 * 60 * 24);

  const valor = valoresQuartos[quarto] * pessoas * dias;

  if (!nome || !telefone || !email || !comprovante || !quarto || !pessoas || !checkin || !checkout) {
    const feedback = document.getElementById("feedback");
    feedback.className = "alert alert-danger mt-3";
    feedback.innerText = "Por favor, preencha todos os campos.";
    return;
  } if (checkout - checkin < 1) {
    const feedback = document.getElementById("feedback");
    feedback.className = "alert alert-danger mt-3";
    feedback.innerText = "Por favor, insira datas de check-in e check-out v치lidas";
    return
  }

  const telefoneRegex = /^\(\d{2}\) \d{5}-\d{4}$/;
  if (!telefoneRegex.test(telefone)) {
    const feedback = document.getElementById("feedback");
    feedback.className = "alert alert-danger mt-3";
    feedback.innerText = "Por favor, insira um telefone v치lido no formato (XX) XXXXX-XXXX.";
    return;
  }

  const existingData = JSON.parse(localStorage.getItem("formData")) || [];
  const id = existingData.length + 1;

  const formData = {
    id,
    nome,
    telefone,
    email,
    comprovanteNome: comprovante.name,
    quarto,
    pessoas,
    valor,
    checkin: document.getElementById("checkin").value,
    dias
  };

  existingData.push(formData);
  localStorage.setItem("formData", JSON.stringify(existingData));

  const feedback = document.getElementById("feedback");
  feedback.className = "alert alert-success mt-3";
  feedback.innerText = "Formul치rio enviado com sucesso!";

  document.querySelector("form").reset();
});

document.getElementById("telefone").addEventListener("input", (event) => {
  let telefone = event.target.value.replace(/\D/g, "");

  if (telefone.length > 11) telefone = telefone.slice(0, 11);

  if (telefone.length >= 6) {
    telefone = `(${telefone.slice(0, 2)}) ${telefone.slice(2, 7)}-${telefone.slice(7)}`;
  } else if (telefone.length >= 3) {
    telefone = `(${telefone.slice(0, 2)}) ${telefone.slice(2)}`;
  } else if (telefone.length > 0) {
    telefone = `(${telefone}`;
  }

  event.target.value = telefone;
});

function atualizaValor() {
  if (document.querySelector('input[name="tipoQuarto"]:checked') != null && document.getElementById("quantidadePessoas") != null && document.getElementById("checkin") != null && document.getElementById("checkout") != null) {
    const lbl = document.getElementById("valor");
    const quarto = document.querySelector('input[name="tipoQuarto"]:checked').value.trim();
    const pessoas = parseInt(document.getElementById("quantidadePessoas").value.trim());
    const valoresQuartos = {
      economico: 150.0,
      conforto: 300.0,
      luxo: 500.0,
      presidencial: 1000.0
    };
    checkin = new Date(document.getElementById("checkin").value)
    checkout = new Date(document.getElementById("checkout").value)
    dias = (checkout - checkin) / (1000 * 60 * 60 * 24);
    const valor = new Intl.NumberFormat('pt-BR', {
      style: 'currency',
      currency: 'BRL'
    }).format(valoresQuartos[quarto] * pessoas * dias);

    if (isNaN(pessoas) || pessoas <= 0) {
      lbl.innerText = "Por favor, insira uma quantidade de pessoas v치lida."
    } else if (dias < 1 || isNaN(dias)) {
      lbl.innerText = "Verifique as datas"
    } else {
      lbl.innerText = valor
    }
  }
}

document.querySelectorAll('input[name="tipoQuarto"]').forEach(input => {
  input.addEventListener("change", atualizaValor);
});
document.getElementById("quantidadePessoas").addEventListener("input", atualizaValor)
document.getElementById("checkout").addEventListener("input", atualizaValor)
document.getElementById("checkin").addEventListener("input", atualizaValor)